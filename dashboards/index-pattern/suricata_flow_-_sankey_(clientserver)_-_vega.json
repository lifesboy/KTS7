{
    "_id": "e6e6a670-64f9-11e8-9e8d-39632dc6b766",
    "_type": "visualization",
    "_source": {
        "title": "Suricata: Flow - Sankey (client/server) - Vega",
        "visState": "{\"title\":\"Suricata: Flow - Sankey (client/server) - Vega\",\"type\":\"vega\",\"params\":{\"spec\":\"{\\n  \\\"$schema\\\": \\\"https://vega.github.io/schema/vega/v3.0.json\\\",\\n  \\\"data\\\": [\\n    {\\n      \\\"name\\\": \\\"rawData\\\",\\n      \\\"url\\\": {\\n        \\\"%context%\\\": true,\\n        \\\"%timefield%\\\": \\\"@timestamp\\\",\\n        \\\"index\\\": \\\"suricata-*\\\",\\n        \\\"body\\\": {\\n          \\\"size\\\": 0,\\n          \\\"aggs\\\": {\\n            \\\"table\\\": {\\n              \\\"composite\\\": {\\n                \\\"size\\\": 1000,\\n                \\\"sources\\\": [\\n                  {\\n                    \\\"stk1\\\": {\\n                      \\\"terms\\\": {\\n                        \\\"field\\\": \\\"client_hostname\\\"\\n                      }\\n                    }\\n                  },\\n                  {\\n                    \\\"stk2\\\": {\\n                      \\\"terms\\\": {\\n                        \\\"field\\\": \\\"server_hostname\\\"\\n                      }\\n                    }\\n                  }\\n                ]\\n              }\\n            }\\n          }\\n        }\\n      },\\n      \\\"format\\\": {\\n        \\\"property\\\": \\\"aggregations.table.buckets\\\"\\n      },\\n      \\\"transform\\\": [\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.key.stk1\\\",\\n          \\\"as\\\": \\\"stk1\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.key.stk2\\\",\\n          \\\"as\\\": \\\"stk2\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.doc_count\\\",\\n          \\\"as\\\": \\\"size\\\"\\n        }\\n      ]\\n    },\\n    {\\n      \\\"name\\\": \\\"nodes\\\",\\n      \\\"source\\\": \\\"rawData\\\",\\n      \\\"transform\\\": [\\n        {\\n          \\\"type\\\": \\\"filter\\\",\\n          \\\"expr\\\": \\\"!groupSelector || groupSelector.stk1 == datum.stk1 || groupSelector.stk2 == datum.stk2\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.stk1+datum.stk2\\\",\\n          \\\"as\\\": \\\"key\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"fold\\\",\\n          \\\"fields\\\": [\\\"stk1\\\", \\\"stk2\\\"],\\n          \\\"as\\\": [\\\"stack\\\", \\\"grpId\\\"]\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.stack == 'stk1' ? datum.stk1+datum.stk2 : datum.stk2+datum.stk1\\\",\\n          \\\"as\\\": \\\"sortField\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"stack\\\",\\n          \\\"groupby\\\": [\\\"stack\\\"],\\n          \\\"sort\\\": {\\n            \\\"field\\\": \\\"sortField\\\",\\n            \\\"order\\\": \\\"descending\\\"\\n          },\\n          \\\"field\\\": \\\"size\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"(datum.y0+datum.y1)/2\\\",\\n          \\\"as\\\": \\\"yc\\\"\\n        }\\n      ]\\n    },\\n    {\\n      \\\"name\\\": \\\"groups\\\",\\n      \\\"source\\\": \\\"nodes\\\",\\n      \\\"transform\\\": [\\n        {\\n          \\\"type\\\": \\\"aggregate\\\",\\n          \\\"groupby\\\": [\\\"stack\\\", \\\"grpId\\\"],\\n          \\\"fields\\\": [\\\"size\\\"],\\n          \\\"ops\\\": [\\\"sum\\\"],\\n          \\\"as\\\": [\\\"total\\\"]\\n        },\\n        {\\n          \\\"type\\\": \\\"stack\\\",\\n          \\\"groupby\\\": [\\\"stack\\\"],\\n          \\\"sort\\\": {\\n            \\\"field\\\": \\\"grpId\\\",\\n            \\\"order\\\": \\\"descending\\\"\\n          },\\n          \\\"field\\\": \\\"total\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"scale('y', datum.y0)\\\",\\n          \\\"as\\\": \\\"scaledY0\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"scale('y', datum.y1)\\\",\\n          \\\"as\\\": \\\"scaledY1\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.stack == 'stk1'\\\",\\n          \\\"as\\\": \\\"rightLabel\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.total/domain('y')[1]\\\",\\n          \\\"as\\\": \\\"percentage\\\"\\n        }\\n      ]\\n    },\\n    {\\n      \\\"name\\\": \\\"destinationNodes\\\",\\n      \\\"source\\\": \\\"nodes\\\",\\n      \\\"transform\\\": [\\n        {\\n          \\\"type\\\": \\\"filter\\\",\\n          \\\"expr\\\": \\\"datum.stack == 'stk2'\\\"\\n        }\\n      ]\\n    },\\n    {\\n      \\\"name\\\": \\\"edges\\\",\\n      \\\"source\\\": \\\"nodes\\\",\\n      \\\"transform\\\": [\\n        {\\n          \\\"type\\\": \\\"filter\\\",\\n          \\\"expr\\\": \\\"datum.stack == 'stk1'\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"lookup\\\",\\n          \\\"from\\\": \\\"destinationNodes\\\",\\n          \\\"key\\\": \\\"key\\\",\\n          \\\"fields\\\": [\\\"key\\\"],\\n          \\\"as\\\": [\\\"target\\\"]\\n        },\\n        {\\n          \\\"type\\\": \\\"linkpath\\\",\\n          \\\"orient\\\": \\\"horizontal\\\",\\n          \\\"shape\\\": \\\"diagonal\\\",\\n          \\\"sourceY\\\": {\\n            \\\"expr\\\": \\\"scale('y', datum.yc)\\\"\\n          },\\n          \\\"sourceX\\\": {\\n            \\\"expr\\\": \\\"scale('x', 'stk1') + bandwidth('x')\\\"\\n          },\\n          \\\"targetY\\\": {\\n            \\\"expr\\\": \\\"scale('y', datum.target.yc)\\\"\\n          },\\n          \\\"targetX\\\": {\\n            \\\"expr\\\": \\\"scale('x', 'stk2')\\\"\\n          }\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"range('y')[0]-scale('y', datum.size)\\\",\\n          \\\"as\\\": \\\"strokeWidth\\\"\\n        },\\n        {\\n          \\\"type\\\": \\\"formula\\\",\\n          \\\"expr\\\": \\\"datum.size/domain('y')[1]\\\",\\n          \\\"as\\\": \\\"percentage\\\"\\n        }\\n      ]\\n    }\\n  ],\\n  \\\"scales\\\": [\\n    {\\n      \\\"name\\\": \\\"x\\\",\\n      \\\"type\\\": \\\"band\\\",\\n      \\\"range\\\": \\\"width\\\",\\n      \\\"domain\\\": [\\\"stk1\\\", \\\"stk2\\\"],\\n      \\\"paddingOuter\\\": 0.01,\\n      \\\"paddingInner\\\": 0.98\\n    },\\n    {\\n      \\\"name\\\": \\\"y\\\",\\n      \\\"type\\\": \\\"linear\\\",\\n      \\\"range\\\": \\\"height\\\",\\n      \\\"domain\\\": {\\n        \\\"data\\\": \\\"nodes\\\",\\n        \\\"field\\\": \\\"y1\\\"\\n      }\\n    },\\n    {\\n      \\\"name\\\": \\\"color\\\",\\n      \\\"type\\\": \\\"ordinal\\\",\\n      \\\"range\\\": \\\"category\\\",\\n      \\\"domain\\\": {\\n        \\\"data\\\": \\\"rawData\\\",\\n        \\\"fields\\\": [\\\"stk1\\\", \\\"stk2\\\"]\\n      }\\n    },\\n    {\\n      \\\"name\\\": \\\"stackNames\\\",\\n      \\\"type\\\": \\\"ordinal\\\",\\n      \\\"range\\\": [\\\"Client\\\", \\\"Server\\\"],\\n      \\\"domain\\\": [\\\"stk1\\\", \\\"stk2\\\"]\\n    }\\n  ],\\n  \\\"axes\\\": [\\n    {\\n      \\\"orient\\\": \\\"bottom\\\",\\n      \\\"scale\\\": \\\"x\\\",\\n      \\\"encode\\\": {\\n        \\\"labels\\\": {\\n          \\\"update\\\": {\\n            \\\"text\\\": {\\n              \\\"scale\\\": \\\"stackNames\\\",\\n              \\\"field\\\": \\\"value\\\"\\n            },\\n            \\\"fontSize\\\": {\\n              \\\"value\\\": 14\\n            }\\n          }\\n        }\\n      }\\n    },\\n    {\\n      \\\"orient\\\": \\\"left\\\",\\n      \\\"scale\\\": \\\"y\\\",\\n      \\\"encode\\\": {\\n        \\\"labels\\\": {\\n          \\\"update\\\": {\\n            \\\"fontSize\\\": {\\n              \\\"value\\\": 12\\n            }\\n          }\\n        }\\n      }\\n    }\\n  ],\\n  \\\"marks\\\": [\\n    {\\n      \\\"type\\\": \\\"path\\\",\\n      \\\"name\\\": \\\"edgeMark\\\",\\n      \\\"from\\\": {\\n        \\\"data\\\": \\\"edges\\\"\\n      },\\n      \\\"clip\\\": true,\\n      \\\"encode\\\": {\\n        \\\"update\\\": {\\n          \\\"stroke\\\": [\\n            {\\n              \\\"test\\\": \\\"groupSelector && groupSelector.stack=='stk1'\\\",\\n              \\\"scale\\\": \\\"color\\\",\\n              \\\"field\\\": \\\"stk2\\\"\\n            },\\n            {\\n              \\\"scale\\\": \\\"color\\\",\\n              \\\"field\\\": \\\"stk1\\\"\\n            }\\n          ],\\n          \\\"strokeWidth\\\": {\\n            \\\"field\\\": \\\"strokeWidth\\\"\\n          },\\n          \\\"path\\\": {\\n            \\\"field\\\": \\\"path\\\"\\n          },\\n          \\\"strokeOpacity\\\": {\\n            \\\"signal\\\": \\\"!groupSelector && (groupHover.stk1 == datum.stk1 || groupHover.stk2 == datum.stk2) ? 0.75 : 0.3\\\"\\n          },\\n          \\\"zindex\\\": {\\n            \\\"signal\\\": \\\"!groupSelector && (groupHover.stk1 == datum.stk1 || groupHover.stk2 == datum.stk2) ? 1 : 0\\\"\\n          },\\n          \\\"tooltip\\\": {\\n            \\\"signal\\\": \\\"datum.stk1 + ' â†’ ' + datum.stk2 + '    ' + format(datum.size, ',.0f') + '   (' + format(datum.percentage, '.1%') + ')'\\\"\\n          }\\n        },\\n        \\\"hover\\\": {\\n          \\\"strokeOpacity\\\": {\\n            \\\"value\\\": 0.75\\n          }\\n        }\\n      }\\n    },\\n    {\\n      \\\"type\\\": \\\"rect\\\",\\n      \\\"name\\\": \\\"groupMark\\\",\\n      \\\"from\\\": {\\n        \\\"data\\\": \\\"groups\\\"\\n      },\\n      \\\"encode\\\": {\\n        \\\"enter\\\": {\\n          \\\"fill\\\": {\\n            \\\"scale\\\": \\\"color\\\",\\n            \\\"field\\\": \\\"grpId\\\"\\n          },\\n          \\\"width\\\": {\\n            \\\"scale\\\": \\\"x\\\",\\n            \\\"band\\\": 1\\n          }\\n        },\\n        \\\"update\\\": {\\n          \\\"x\\\": {\\n            \\\"scale\\\": \\\"x\\\",\\n            \\\"field\\\": \\\"stack\\\"\\n          },\\n          \\\"y\\\": {\\n            \\\"field\\\": \\\"scaledY0\\\"\\n          },\\n          \\\"y2\\\": {\\n            \\\"field\\\": \\\"scaledY1\\\"\\n          },\\n          \\\"fillOpacity\\\": {\\n            \\\"value\\\": 0.7\\n          },\\n          \\\"tooltip\\\": {\\n            \\\"signal\\\": \\\"datum.grpId + '   ' + format(datum.total, ',.0f') + '   (' + format(datum.percentage, '.1%') + ')'\\\"\\n          }\\n        },\\n        \\\"hover\\\": {\\n          \\\"fillOpacity\\\": {\\n            \\\"value\\\": 1\\n          }\\n        }\\n      }\\n    },\\n    {\\n      \\\"type\\\": \\\"text\\\",\\n      \\\"from\\\": {\\n        \\\"data\\\": \\\"groups\\\"\\n      },\\n      \\\"interactive\\\": false,\\n      \\\"encode\\\": {\\n        \\\"update\\\": {\\n          \\\"x\\\": {\\n            \\\"signal\\\": \\\"scale('x', datum.stack) + (datum.rightLabel ? bandwidth('x') + 8 : -8)\\\"\\n          },\\n          \\\"yc\\\": {\\n            \\\"signal\\\": \\\"(datum.scaledY0 + datum.scaledY1)/2\\\"\\n          },\\n          \\\"align\\\": {\\n            \\\"signal\\\": \\\"datum.rightLabel ? 'left' : 'right'\\\"\\n          },\\n          \\\"baseline\\\": {\\n            \\\"value\\\": \\\"middle\\\"\\n          },\\n          \\\"fontWeight\\\": {\\n            \\\"value\\\": \\\"bold\\\"\\n          },\\n          \\\"fontSize\\\": {\\n            \\\"value\\\": 12\\n          },\\n          \\\"text\\\": {\\n            \\\"signal\\\": \\\"abs(datum.scaledY0-datum.scaledY1) > 11 ? datum.grpId : ''\\\"\\n          }\\n        }\\n      }\\n    },\\n    {\\n      \\\"type\\\": \\\"group\\\",\\n      \\\"data\\\": [\\n        {\\n          \\\"name\\\": \\\"dataForShowAll\\\",\\n          \\\"values\\\": [{}],\\n          \\\"transform\\\": [\\n            {\\n              \\\"type\\\": \\\"filter\\\",\\n              \\\"expr\\\": \\\"groupSelector\\\"\\n            }\\n          ]\\n        }\\n      ],\\n      \\\"encode\\\": {\\n        \\\"enter\\\": {\\n          \\\"xc\\\": {\\n            \\\"signal\\\": \\\"width/2\\\"\\n          },\\n          \\\"y\\\": {\\n            \\\"value\\\": 30\\n          },\\n          \\\"width\\\": {\\n            \\\"value\\\": 100\\n          },\\n          \\\"height\\\": {\\n            \\\"value\\\": 36\\n          }\\n        }\\n      },\\n      \\\"marks\\\": [\\n        {\\n          \\\"type\\\": \\\"group\\\",\\n          \\\"name\\\": \\\"groupReset\\\",\\n          \\\"from\\\": {\\n            \\\"data\\\": \\\"dataForShowAll\\\"\\n          },\\n          \\\"encode\\\": {\\n            \\\"enter\\\": {\\n              \\\"cornerRadius\\\": {\\n                \\\"value\\\": 3.5\\n              },\\n              \\\"fill\\\": {\\n                \\\"value\\\": \\\"#666666\\\"\\n              },\\n              \\\"height\\\": {\\n                \\\"field\\\": {\\n                  \\\"group\\\": \\\"height\\\"\\n                }\\n              },\\n              \\\"width\\\": {\\n                \\\"field\\\": {\\n                  \\\"group\\\": \\\"width\\\"\\n                }\\n              }\\n            },\\n            \\\"update\\\": {\\n              \\\"opacity\\\": {\\n                \\\"value\\\": 1\\n              }\\n            },\\n            \\\"hover\\\": {\\n              \\\"fill\\\": {\\n                \\\"value\\\": \\\"#444444\\\"\\n              }\\n            }\\n          },\\n          \\\"marks\\\": [\\n            {\\n              \\\"type\\\": \\\"text\\\",\\n              \\\"interactive\\\": false,\\n              \\\"encode\\\": {\\n                \\\"enter\\\": {\\n                  \\\"xc\\\": {\\n                    \\\"field\\\": {\\n                      \\\"group\\\": \\\"width\\\"\\n                    },\\n                    \\\"mult\\\": 0.5\\n                  },\\n                  \\\"yc\\\": {\\n                    \\\"field\\\": {\\n                      \\\"group\\\": \\\"height\\\"\\n                    },\\n                    \\\"mult\\\": 0.5,\\n                    \\\"offset\\\": 1\\n                  },\\n                  \\\"align\\\": {\\n                    \\\"value\\\": \\\"center\\\"\\n                  },\\n                  \\\"baseline\\\": {\\n                    \\\"value\\\": \\\"middle\\\"\\n                  },\\n                  \\\"text\\\": {\\n                    \\\"value\\\": \\\"Show All\\\"\\n                  },\\n                  \\\"fontSize\\\": {\\n                    \\\"value\\\": 14\\n                  },\\n                  \\\"stroke\\\": {\\n                    \\\"value\\\": \\\"#ecf0f1\\\"\\n                  }\\n                }\\n              }\\n            }\\n          ]\\n        }\\n      ]\\n    }\\n  ],\\n  \\\"signals\\\": [\\n    {\\n      \\\"name\\\": \\\"groupHover\\\",\\n      \\\"value\\\": {},\\n      \\\"on\\\": [\\n        {\\n          \\\"events\\\": \\\"@groupMark:mouseover\\\",\\n          \\\"update\\\": \\\"{stk1:datum.stack=='stk1' && datum.grpId, stk2:datum.stack=='stk2' && datum.grpId}\\\"\\n        },\\n        {\\n          \\\"events\\\": \\\"mouseout\\\",\\n          \\\"update\\\": \\\"{}\\\"\\n        }\\n      ]\\n    },\\n    {\\n      \\\"name\\\": \\\"groupSelector\\\",\\n      \\\"value\\\": false,\\n      \\\"on\\\": [\\n        {\\n          \\\"events\\\": \\\"@groupMark:click!\\\",\\n          \\\"update\\\": \\\"{stack:datum.stack, stk1:datum.stack=='stk1' && datum.grpId, stk2:datum.stack=='stk2' && datum.grpId}\\\"\\n        },\\n        {\\n          \\\"events\\\": [\\n            {\\n              \\\"type\\\": \\\"click\\\",\\n              \\\"markname\\\": \\\"groupReset\\\"\\n            }, {\\n              \\\"type\\\": \\\"dblclick\\\"\\n            }\\n          ],\\n          \\\"update\\\": \\\"false\\\"\\n        }\\n      ]\\n    }\\n  ]\\n}\\n\"},\"aggs\":[]}",
        "uiStateJSON": "{}",
        "description": "",
        "version": 1,
        "kibanaSavedObjectMeta": {
            "searchSourceJSON": "{\"query\":{\"query\":\"\",\"language\":\"kuery\"},\"filter\":[]}"
        }
    },
    "_meta": {
        "savedObjectVersion": 2
    },
    "_migrationVersion": {
        "visualization": "7.0.1"
    },
    "_references": []
}